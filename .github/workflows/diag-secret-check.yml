name: Diagnostic Secret Availability Check

on:
  pull_request:
    types: [opened, synchronize, reopened]
    branches:
      - master
    paths:
      - 'Solutions/**/Package/mainTemplate.json'

jobs:
  check-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Check if Azure login works (without leaking secrets)
        shell: bash
        run: |
          echo "Running Azure login diagnostic check..."

          # Try to log in using the injected OIDC/secret credentials
          if az account show --output none 2>/dev/null; then
            echo "SECRET_STATUS=INJECTED"
          else
            echo "SECRET_STATUS=NOT_AVAILABLE"
          fi
